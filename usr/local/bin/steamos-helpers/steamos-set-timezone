#!/bin/bash
# =============================================================================
# PROJECT:      SteamMachine-DIY
# Version:      1.0.0
# DESCRIPTION:  Compatibility shim for SteamOS timezone synchronization.
#               Intercepts Steam Client requests to change system timezone.
# PHILOSOPHY:   KISS (Keep It Simple, Stupid)
# REPOSITORY:   https://github.com/dlucca1986/SteamMachine-DIY
# PATH:         /usr/local/bin/steamos-helpers/steamos-set-timezone
# LICENSE:      MIT
# =============================================================================

# --- 1. CORE INITIALIZATION ---
# Load the master configuration to inherit the centralized LOG_FILE path.
MASTER_CONFIG="/etc/default/steamos-diy"

if [ -f "$MASTER_CONFIG" ]; then
    source "$MASTER_CONFIG"
else
    # Fallback log location if master config is missing.
    LOG_FILE="/tmp/steamos-diy-fallback.log"
fi

# --- 2. LOGGING HELPER ---
log_shim() {
    local timestamp
    timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local msg="[$timestamp] [TIME-SHIM] $1"
    
    echo -e "$1"
    echo "$msg" >> "$LOG_FILE"
}

# --- 3. EXECUTION ---
# Capture the target timezone passed as the first argument (default to UTC).
TARGET_ZONE="${1:-UTC}"

log_shim "Intercepting Steam Client timezone request: ${TARGET_ZONE}"
log_shim "Timezone request acknowledged. System settings remain unchanged to preserve host OS integrity."

# Exit with success (0) to satisfy the Steam Client's UI feedback.
exit 0
